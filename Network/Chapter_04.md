### 1. ADSL 기술을 이용한 액세스 회선의 구조와 동작
#### 1. 인터넷의 기본은 가정이나 회사의 LAN과 같음
- 인터넷의 내부에는 수만 대 이상의 라우터가 있고 이것이 수신처 IP 주소를 바탕으로 중계 대상을 판단하면서 패킷을 중계함, 다수의 라우터가 차례대로 중계해서 패킷을 목적지에 전달함
- 가정이나 회사의 LAN의 규모가 커진게 인터넷이고 인터넷이 다른 점은 중계 장치간의 거리가 매우 멀다는 점이 있음 (이더넷 케이블로 연결 불가)
- 라우팅 테이블에 정보를 등록하는 부분도 다름, 양이 너무 많기 때문에 자동화함
#### 2. 사용자와 인터넷을 연결하는 액세스 회선
- 스위치와 라우터로 패킷을 중계하면 목적지 서버를 향해 진행하는데 인터넷 접속용 라우터를 경유해서 인터넷으로 나감
- 인터넷 접속용 라우터는 액세스 회선의 규칙에 따라 패킷 송신 동작을 실행함
- 액세스 회선은 인터넷과 가정, 회사의 LAN을 연결하는 통신 회선을 말함
- 일반 가정이라면 ADSL, FTTH, 전화회선 등을 사용
#### 3. ADSL 모뎀에서 패킷을 셀로 분할
- 사용자가 송신한 패킷은 허브를 경유하여 인터넷 접속용 라우터에 도착하고 이데넷의 패킷에서 IP 패킷을 추출하여 중계 대상을 판단하는 부분은 이더넷과 다르지 않음
- 헤더가 조금 달라지는데 PPPoE의 경우 인터넷 접속용 라우터는 MAC, PPPoE, PPP 세개의 헤더를 붙이고 ADSL 모뎀에 패킷을 보냄
- ADSL 모뎀은 패킷을 셀 단위로 분할해서 저장함, 셀은 맨 앞에 5바이트 헤더를 가지고 있고 뒤에 48바이트 데이터로 구성된 작은 디지털 데이터
- ATM이라는 전화 기술이 당시에 개발되고 있었기 때문에 이를 활용하기 위해 셀로 분할하는 것임, 셀로 분할하지 않는 유형의 ADSL 모뎀도 있음
#### 4. ADSL은 변조 방식으로 셀을 신호화
- LAN의 경우 사각형 신호로 0과 1을 나타내는 변환을 사용했는데 ADSL은 좀 더 복잡하게 변환함
- 사각형 신호는 거리가 멀면 파형이 뭉개지기 쉽고 낮은 주파수에서 높은 주파수까지 넓은 범위의 주파수가 포함되기 때문
- 신호의 주파수가 높아지면 주위에 방사되는 잡음의 양이 증가함
- ADSL 모뎀은 완만한 파형을 합성한 신호에 0과 1의 비트 값을 대응시키는 기술을 사용했는데 이를 변조 기술이라고함
- 변조 기술은 진폭 변조(ASK)와 위상 변조(PSK)를 결합한 직교 진폭 변조(QAM)을 사용함
- 진폭 변조 방식이란 신호의 진폭의 크기에 0과 1을 대응시키는 방법으로 진폭이 작은 신호는 0, 진폭이 큰 신호는 1로 대응시키는 것
- 진폭을 단계별로 나누면 표현할 수 있는 범위가 늘어남으로 운반하는 데이터양이 늘지만 파형 변형에 의한 오류가 발생할 수 있으므로 주의
- 위상 변조 방식은 신호의 위상에 0과 1을 대응시키는 방법으로 한 번 순환하는 주기 중 어디부터 시작되는지에 따라 0과 1을 대응시키는 것
- 각도별로 세분화하면 대응시킬 수 있는 범위가 늘어나지만 역시 구별하기 어려워서 오류가 발생할 수 있으니 주의
- ADSL에서 사용하는 직교 진폭 변조 방식은 이들 두 가지를 결합한 방식으로 진폭과 위상에 1비트씩 대응하여 한 파에 2비트분의 데이터를 대응
#### 5. ADSL은 파를 많이 사용하여 고속화를 실현
- 주파수가 서로 다른 파를 혼합해서 합성파를 만들고 특정 주파수의 파만 통과시키는 필터 회로를 사용하면 주파수마다 파를 분리할 수 있음
- 합성파를 사용하면 대응시킬 수 있는 비트 수가 사용하는 파를 곱한 수 만큼 증가
- ADSL은 다수의 파에 비트값을 대응시켜서 고속화를 수행, 주파수를 다르게 한 수백 개의 파에 잡음 등의 상태를 고려하여 한 개의 파에 수 비트에서 수십 비트를 대응시킴
- ADSL은 사용자->인터넷(업로드)와 인터넷->사용자(다운로드)의 전송속도가 다른데 다운로드는 많은 수의 파를 사용하기 때문에 차이 발생
- 높은 주파수의 파(다운로드)는 감쇠가 크고 잡음의 영향을 받기 쉬우므로 거리가 멀수록 적은 수의 비트를 지원하게 되서 속도가 떨어짐
- 따라서 ADSL에는 회선 상태를 조사해서 사용할 파의 수나 비트 수를 판단하도록 시험 신호를 보내는 과정이 있는데 이를 트레이닝이라고 함 
#### 6. 스플리터의 역할
- ADSL 모뎀에서 전기 신호로 변환된 셀은 다음에 스플리터라는 장치에 들어가고 ADSL의 신호는 전화의 음성 신호와 섞여서 전화 회선에 함께 흘러나감
- 스플리터가 하는 일은 송신에선 아무것도 하지 않지만 전화 회선에서 신호가 흘러들어올 때 전화와 ADSL의 신호를 나누는 역할을 수행함
- 전화기 측에 ADSL의 신호가 흐르지 않도록 ADSL의 높은 주파수 신호를 차단해서 전화기에는 전화 신호만 흐르고 ADSL 모뎀으로 향하는 신호는 그대로 흐름
- ADSL 모뎀 내부에는 ADSL에 사용하는 주파수에서 벗어난 불필요한 주파수를 차단하는 기능이 있으므로 여기서 스플리터가 차단할 필요가 없음
- 또한 수화기를 들면 회선의 상태가 변하게 되므로 상태를 조사하는 트레이닝을 다시해야하는데 스플리터가 이 문제를 방지함
#### 7. 전화국까지의 여정
- 스플리터를 지나면 전화 케이블을 꽂은 커넥터가 있고 이곳을 통과하면 건물의 배선반으로 이어짐
- 배선반을 지나면 과전류를 방어하는 보안기(퓨즈가 들어있음)가 있고 이곳을 지나면 신호는 전주(전봇대)의 전화 케이블로 들어가서 전화국으로 이어짐
#### 8. 잡음의 영향
- 전화 케이블 속을 신호과 통과할 때 여러 잡음의 영향을 받음.
- 이더넷의 트위스트 케이블처럼 외부, 내부 잡음의 영향을 받는데 이더넷의 경우 사각형 신호 하나만 진행하기 떄문에 이 신호가 변형되면 디지털 데이터를 읽을 수 없게 되어 오류가 생기지만 ADSL은 다수의 주파수로 구성되어 있어서 잡음과 겹치는 주파수만 사용할 수 없게됨 (신호 수가 줄어듬으로 속도 저하)
#### 9. DSLAM을 통과하여 BAS에 도달
- 전화국에 도착하면 배선반과 스플리터를 통과해서 DSLAM에 도달하고 전기 신호가 디지털 데이터의 셀로 복원됨
- 복원 원리는 DSLAM 에서 신호의 파형을 읽어 진폭과 위상을 조사하고 이것이 어느 비트 값에 대응하는지 판단해서 디지털 데이터로 복원함
- 이 동작은 ADSL 모뎀의 수신 동작과 동일한데 사실 DSLAM 은 ADSL 모뎀에 해당하는 기능을 묶어서 만든것으로 ADSL 모뎀은 이더넷 인터페이스가 있어서 사용자측의 라우터나 PC와 이더넷으로 송,수신하지만 DSLAM은 이더넷 대신 ATM 인터페티스로 패킷을 분할한 셀의 형태로 후방의 라우터와 주고받음
- DSLAM을 나온 셀은 BAS라는 패킷 중계 장치에 도착하는데 DSLAM 처럼 ATM 인터페이스가 있고 셀을 수신함
- ATM 인터페이스는 수신한 셀을 패킷으로 복원하는 기능이 있어서 셀을 원래 패킷으로 복원하는 것으로 BAS의 수신 동작이 끝남
- 그러면 수신한 패킷 맨 앞에 MAC, PPPoE 헤더를 버리고 PPP 헤더 이후 부분을 추출함
- MAC, PPPoE 헤더는 BAS 인터페이스에 패킷을 건네주기 위해 사용하기 때문에 여기서 없어짐
- 터널링용 헤더를 붙여서 터널링의 출구를 향해 중계해서 터널링 출구에 있는 터널링용 라우터에 도착하는데 터널링용 헤더를 분리하고 IP 패킷을 추출해서 인터넷 내부에 중계함
### 2. 광섬유를 이용한 액세스 회선(FTTH)
#### 1. 광섬유의 기본
- 광섬유는 신호를 밝은 상태를 1, 어두운 상태를 0으로 나타냄
- 디지털 데이터를 전기 신호로 바꿔서 LED나 포토 다이오드 같은 광원에 입력하면 빛을 발하게 되고 빛이 광섬유를 따라 진행되어 수신측에 도달하면 수신측에는 빛에 밝기에 따라 전압을 발생시키는 수광 소자가 있음으로 빛을 다시 전기 신호로 바꿔서 데이터를 수신할 수 있음
#### 2. 싱글모드, 멀티모드
- 광섬유에 입사하는 빛은 각도가 다양한데, 그 중에서 반사될 때 위상이 같은 각도로 입사된 소수의 빛만 멀리 도달함, 코어의 직경은 이 각도를 고려하여 결정됨
- 코어의 직경은 싱글모드(가는 것), 멀티모드(굵은 것)으로 분류
- 싱글모드는 입사각이 가장 작은 빛만 들어가고, 멀티모드는 복수의 빛이 들어감
- 멀티모드는 반사각이 큰 빛의 경우 진행하는 코스의 길이가 길어지는데 신호들이 도착하는 시간이 일정하지 않아 변형될 수 있음 (신호의 폭이 길어짐)
- 싱글모드는 빛이 하나라서 변형 가능성이 적으나 수광 소자의 성능이 중요함
- 때문에 싱글모드의 케이블 길이는 멀티모드 보다 길게 할 수 있음
- 멀티모드 광섬유는 한 건물 안을 연결하는 용도로 사용하고 싱글모드 광섬유는 멀리 떨어진 장소를 연결할 때 사용하는데 FTTH는 후자이므로 싱글모드 광섬유를 사용함
#### 3. 광섬유를 분기시켜서 비용 절감
- ADSL 대신 광섬유를 사용해서 사용자측의 인터넷 접속용 라우터와 인터넷측의 BAS를 접속하는 것이 FTTH 액세스 회선, 두 가지 형태 존재
- 한 개의 광섬유로 사용자측과 가장 가까운 전화국측을 직접 연결하여 접속하는 유형
- 사용자측의 미디어 컨버터라는 장치로 이더넷의 전기 신호를 광신호로 변환하여 전송하고 집합형 미디어 컨버터에서 전기 신호로 복원되어 BAS의 포트가 수신하고 인터넷의 내부로 패킷을 중계
- 인터넷측에서 보내는 광신호도 같은 광섬유로 보내는데 서로 다른 파장으로 보냄으로 섞여도 문제가 안됨 (프리즘의 원리)
- 다른 유형은 사용자 부근 전주(전봇대)에 광스플리터라는 분기 장치를 설치하고 여기서 광섬유를 분기시켜서 복수의 사용자를 연결하는 유형
- 미디어 컨버터 대신 사용자 측에 ONU라는 장치를 설치하고 전화국 측의 BAS 앞에 OLT를 설치함
- ONU, OLT는 미디어 컨버터처럼 전기신호를 광신호로 바꿔주는 역할을 수행하고 거기에 더해 복수의 사용자 패킷 충돌을 막기위해 송신 타이밍을 조절하는 기능이 있음
- PPPoE 방식을 사용한다면 IP 헤더앞에 MAC, PPPoE, PPP 헤더가 붙는다는 관점에서 ADSL이랑 비슷함
- 단지 셀로 분할하지 않고 이더넷 신호를 바로 광신호로 바꾸어 전송할 뿐
- 미디어 컨버터나 ONU, OLT는 그냥 종단 장치라고 부르기도 함
### 3. 액세스 회선으로 이용하는 PPP와 터널링
#### 1. 본인 확인과 설정 정보를 통지
- 인터넷은 다수의 라우터를 연결해서 만든 것이기에 액세스 회선을 라우터에 연결하는 것이 원칙
- 액세스 회선이 ADSL, FTTH처럼 진화했는데 라우터도 진화한게 BAS임
- BAS의 진화한 기능은 본인 확인과 설정값 통지인데  ADSL이나 FTTH의 액세스 회선은 최초에 사용자명과 패스워드를 입력해서 로그인 동작을 수행해야함
- 이때 BAS가 PPPoE를 사용해서 로그인 창구 역할을 수행함 
- PPPoE는 전화 회선을 이용한 다이얼업 접속으로 이용하는 PPP 구조를 발전시킨 것임
- PPP는 프로바이더의 액세스 포인트에 전화를 걸고 로그인 정보를 입력해서 로그인을 시도함
- 사용자명과 패스워드는 RAS에서 RADIUS라는 프로토콜을 사용해서 인증 서버에 전송되고 검사받음
- 정확하다고 확인되면 인증 서버에서 IP 주소등의 설정 정보가 반환되므로 사용자의 PC는 이 정보에 따라 IP 주소등을 설정하며 TCP/IP의 패킷을 송, 수신할 준비가 됨
- 다이얼업 접속 방식에서는 전화번호에 따라 액세스 포인트가 바뀌므로 PC에 글로벌 주소를 고정할 수 없어서 접속되었을 때 설정 정보로 글로벌 주소를 알려주는 거임
#### 2. 이더넷에서 PPP 메시지를 주고받는 PPPoE
- ADSL이나 FTTH도 PC에 글로벌 주소를 설정해야 하는데 얘네는 사용자와 BAS를 케이블로 고정적으로 접속하므로 본인인지 확인할 필요는 없으나 사용자명과 패스워드를 입력하는 동작은 남겨서 인터넷에 누가 액세스하는지 관리함
- 그래서 ADSL, FTTH에도 PPP 구조를 사용하기로 했고 과정은 아래와 같음
- 1) 다이얼업 접속의 PPP
- - 1-1) 사용자명/패스워드를 바탕으로 PPP 메시지 작성
- - 1-2) PPP 메시지를 HDLC 프레임에 저장하여 송신
- - 1-3) 모뎀이 프레임을 받아 회선용 신호로 변환하여 전화 회선이나 ISDN 회선에 송신
- - 1-4) RAS에서 신호를 프레임으로 복원하고 메시지를 추출해서 인증 서버에 RADIUS 프로토콜로 전달
- - 1-5) 인증 서버에서 검사 후 IP 주소 등 설정 정보 반환
- 2) ADSL의 PPP (PPPoE)
- - 2-1) 사용자명/패스워드를 바탕으로 PPP 메시지 작성
- - 2-2) PPP 메시지를 이더넷 패킷에 저장하여 송신
- - 2-3) 이더넷 패킷을 ATM 셀에 저장(분할)하여 ADSL 모뎀에서 변조하여 전화 회선에 송신
- - 2-4) 전화국의 DSLAM에서 수신하여 셀로 복원하고 BAS에 송신
- - 2-5) BAS에서 셀을 이더넷 패킷으로 복원하고 PPP 메시지를 추출하여 인증 서버에 RADIUS 프로토콜로 전달
- - 2-6) 인증 서버에서 검사 후 IP 주소 등 설정 정보 반환
- 3) FTTH의 PPP (PPPoE)
- - 3-1) 사용자명/패스워드를 바탕으로 PPP 메시지 작성
- - 3-2) PPP 메시지를 이더넷 패킷에 저장하여 송신
- - 3-3) 이더넷 패킷을 광신호로 변환하여 송신 (ONU)
- - 3-4) 광신호를 수신하여 이더넷 패킷으로 복원 (OLT)
- - 3-5) BAS에서 PPP 메시지를 추출하여 인증 서버에 RADIUS 프로토콜로 전달
- - 3-6) 인증 서버에서 검사 후 IP 주소 등 설정 정보 반환
- PPP 프로토콜에는 프리앰블이나 FCS같은 규정이 없어서 그대로 보낼 수 없음
- 그래서 다이얼업 회선에선 HDLC라는 통신 회선을 사용한 패킷 운반 프로토콜을 그릇으로 사용했는데 ADSL이나 FTTH도 이더넷 패킷을 그릇으로 사용해서 PPP 프로토콜을 사용함
#### 3. 터널링 기능에 의해 프로바이더에 패킷을 전달
- BAS에는 본인 확인 창구 역할 기능과 함께 터널링 기능을 재공
- 터널링은 소켓과 소켓을 연결하는 TCP 커넥션과 비슷함
- 한쪽에 데이터를 넣으면 반대쪽으로 데이터가 나오는 것
- BAS와 프로바이더 라우터 사이에 터널을 만들면 사용자의 액세스 회선이 프로바이더의 라우터까지 연결되는 것과 같음
- 터널링 방법은 TCP 커넥션, 캡슐화 등을 사용
#### 4. 액세스 회선 전체의 동작
- 
