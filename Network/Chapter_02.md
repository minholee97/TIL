### 1. 소켓 작성
#### 1. 프로토콜 스택의 내부 구성
- 프로토콜 스택 윗 부분에는 TCP, UDP 프로토콜이 있고 아랫 부분에는 IP 프로토콜이 있다
- TCP : 브라우저나 메일 등의 일반적인 애플리케이션이 데이터를 송, 수신할 경우
- UDP : DNS 서버에 대한 조회 등에서 짧은 제어용 데이터를 송, 수신할 경우
- IP : 인터넷에서 데이터를 운반할 때 데이터를 작게 나눈 패킷이라는 형태로 운반하는데 패킷을 상대까지 운반하는 역할을 수행
- IP 안에는 ICMP와 ARP 프로토콜을 다루는 부분이 있음
- ICMP는 패킷을 운반할 때 발생하는 오류를 통지, ARP는 IP 주소에 대응하는 MAC 주소를 조사
#### 2. 소켓은 통신 제어용 제어 정보
- 프로토콜 스택 내부에는 제어 정보를 기록하는 메모리 영역을 가지고 있음
- 통신 상대의 IP 주소, 포트번호, 통신 진행 상태, 응답 여부 등
- 제어 정보가 기록된 메모리 영역을 소켓이라고 하고 프로토콜 스택은 소켓을 참조하면서 움직임
#### 3. Socket을 호출했을 때 동작
- socket 호출 시 소켓의 제어 정보를 기록하는 메모리 영역을 확보하고 디스크립터를 반환함
- 디스크립터는 프로토콜 스택 내부에 있는 다수의 소켓 중 어느 것을 가리키는지 나타내는 번호표 같은 정보
- 이후 애플리케이션이 디스크립터를 사용하여 데이터 송, 수신 동작을 의뢰
### 2. 서버 접속
#### 1. 접속의 의미
- IP 주소와 포트 번호를 소켓(프로토콜 스택)에 저장한다
- 서버측과 제어 정보를 주고 받아 송, 수신할 수 있는 상태를 만든다
- 송, 수신하는 데이터를 일시적으로 저장하는 버퍼 메모리를 확보한다
#### 2. 제어정보를 기록한 헤더 배치
- 제어정보를 가진 헤더는 서버와 클라이언트가 대화할 때마다 주고 받는 패킷 앞에 배치됨
- TCP 헤더, MAC 헤더, IP 헤더 (층마다 헤더가 있음)
- 헤더에 기록된 제어정보를 통해 대화가 이루어짐
- TCP 헤더 : 송신처 포트 번호, 수신처 포트 번호, 시퀀스 번호, ACK 번호, 데이터 오프셋, 컨트롤 비트 등
- 접속 단계에서는 데이터가 없으므로 패킷이 헤더로만 이루어짐
- 소켓에도 기록되는 제어정보가 있음 (애플리케이션에서 통지된 정보, 송, 수신 현황), 이 정보를 통해 프로토콜 스택이 움직임
- 결론적으로 통신 동작에 이용하는 제어 정보는 헤더에 기입되는 정보와, 소켓에 기록되는 정보 두 가지가 있음
#### 3. 접속 동작의 실체
- connect() 호출이 접속의 시작
- 여기에 서버측 IP 주소, 포트 번호를 쓰면 프로토콜 스택의 TCP 담당 부분에 전달되고 서버의 TCP 담당 부분과 제어 정보를 주고 받음
- 이 과정은 먼저 데이터 송, 수신 동작의 개시를 나타내는 제어 정보를 기록한 TCP 헤더를 만듬 (포트번호가 중요)
- 따라서 송, 수신측의 소켓을 지정할 수 있고 컨트롤 비트 중 SYN 비트를 1로 만듬
- TCP 헤더가 완성되면 IP 담당 부분에 건네주어 송신을 의뢰
- 서버의 IP 담당 부분에서 TCP 담당 부분에게 건네주고 TCP 담당 부분은 헤더를 조사하여 접속을 기다리는 소켓 중 기록된 포트 번호에 해당하는 소켓을 찾음
- 찾아내면 필요한 정보를 기록하고 접속 동작이 진행중이라는 상태로 바뀌고 응답을 돌려줌
- 응답은 SYN 비트를 1, ACK 비트를 1로 만든 헤더를 만들어서 IP 담당 부분에게 의뢰
- 그러면 패킷이 클라이언트에게 돌아오고 SYN 비트를 확인하여 접속 성공을 확인하고 ACK 비트를 1로 만든 TCP 헤더를 서버에 전송
- 이로써 소켓은 데이터를 송, 수신할 수 있는 상태가 됨
#### 4.
